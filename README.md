# gateway-man
从零开始,手写一个网关框架



### 引言
随着微服务架构的流行，构建高效、可扩展的API网关至关重要。Spring WebFlux的响应式模型在处理高并发请求时表现出色。本项目旨在创建一个基于WebFlux的自定义API网关，具备路由、认证、过滤等功能。

### 总体设计
- **目标**：构建轻量级、高性能的API网关，支持服务发现和流量控制。
- **架构**：采用单体设计，利用WebFlux的响应式特性，确保低延迟和高吞吐量。
- **原则**：灵活性、可扩展性和可维护性是设计的核心。

### 技术选型
- **前端框架**：Spring WebFlux，用于响应式编程和HTTP路由。
- **服务发现**：使用Zookeeper 或者是作者手写的 registry-man 注册中心框架, https://github.com/ipipman/registry-man。
- **安全**：JWT令牌，结合Spring Security实现认证和授权。
- **监控**：待定。

### 功能模块
1. **路由管理**：根据URL和HTTP方法，将请求转发至相应后端服务。
2. **认证与授权**：实现JWT令牌验证，确保请求经过身份验证。
3. **过滤器链**：包括限流、日志记录、CORS处理等中间件。
4. **服务发现**：动态发现和路由到后端服务实例。
5. **异常处理**：全局异常处理器，转换异常为标准HTTP响应。

### 核心功能实现
1. **路由配置**：使用`RouterFunctions`创建路由规则。
2. **处理函数**：实现无阻塞处理逻辑，使用`Mono`或`Flux`处理数据流。
3. **过滤器实现**：创建`WebFilter`，例如认证过滤器、限流过滤器。
4. **服务发现**：集成Zookeeper或registry-man，动态获取服务列表。
5. **异常处理**：创建`ErrorWebExceptionHandler`处理未捕获的异常。

## 总结
通过以上设计和实现，我们创建了一个WebFlux响应式API网关，具备处理高并发、灵活路由、认证和过滤功能。结合服务发现和监控，保证了系统扩展性和稳定性，适应业务发展需求。



<img src="https://ipman-blog-1304583208.cos.ap-nanjing.myqcloud.com/gateway%2F481716635057_.pic_hd.jpg" alt="471716634427_.pic_hd" style="zoom:50%;" />
